# 01 ‚Äì PostgreSQL

[PostgreSQL](https://cs.wikipedia.org/wiki/PostgreSQL) (zkr√°cenƒõ _Postgres_) je:

- modern√≠, ‚Äûdospƒõl√Ω‚Äú datab√°zov√Ω syst√©m (‚Äûdatab√°ze‚Äú)
- FLOSS (Free/Libre Open Source Software, ‚Äûvoln√Ω a otev≈ôen√Ω‚Äú)
- cross-platform
- ≈°k√°lovateln√Ω (scalable)
- jeho v√Ωvoj je podporovan√Ω komunitou

Jm√©no:

- 1970s [Ingres](https://en.wikipedia.org/wiki/Ingres_%28database%29)
- 1985 ‚ûú POSTGRES
- 1996 ‚ûú PostgreSQL (zmƒõna POSTQUEL na SQL)

## Datab√°zov√Ω syst√©m + n√°stroje:

- [PostgreSQL](https://www.postgresql.org/)
- [pgAdmin](https://www.pgadmin.org/)
- [DBeaver Community Edition](https://dbeaver.io/)
- [CloudBeaver Community](https://dbeaver.com/docs/cloudbeaver/)
- jin√©?

# Instalace a bƒõh v Dockeru

Pot≈ôebujete:

- [Docker Desktop](https://www.docker.com/products/docker-desktop/)
- [docker-compose.yml](../projekt/docker-compose.yml)

Postavit a spustit multi-kontejner, v termin√°lu:

```bash
docker compose up # p≈ô√≠padnƒõ: --build
```

V prohl√≠≈æeƒçi:

- pgAdmin: [localhost:8001](http://localhost:8001)
- CloudBeaver: [localhost:8002](http://localhost:8002)

## Konfigurace pgAdmin:

- Login: me@me.me / me (nastaveno v docker-compose.yml)
- Object / Register / Server:
  - General/Name: ....
  - Connection/Host name: kontejner `postgres` (nikoli `localhost`)
  - Username: `dbusr`, Password: `dbpwd` (nastaveno v docker-compose.yml)

## Konfigurace CloudBeaver:

- Nastaven√≠: Administrator Credentials
  - zvolte Login / Password
- Login:
  - zvolen√Ω Login / Password
- `[+]` / Find Database (nebo:New Connection: PostgreSQL)
  - Host: `postgres` ‚ûú postgres:5432
  - Authentication: `dbusr` / `dbpwd`
  - Test ‚ûú Create

## Prov√°dƒõn√≠ SQL p≈ô√≠kaz≈Ø

- pgAdmin: Tools / Query Tool
- CloudBeaver: SQL

# pgAdmin

Servers / me / Databases(2)

- postgres (v√Ωchoz√≠ syst√©mov√° datab√°ze)
- **dbusr** (vytvo≈ôen√° v docker-compose.yml)

```sql
SELECT version();
```

> PostgreSQL 18.0 ...

_SQL nerozli≈°uje velikost p√≠smen. Tradiƒçnƒõ se kl√≠ƒçov√° slova zapisuj√≠ velk√Ωmi p√≠smeny - tradice z doby p≈ôed "syntax highlighting"?_

```sql
select version(); -- funguje stejnƒõ, budu tedy ps√°t mal√Ωmi p√≠smeny
```

# [SQL](https://en.wikipedia.org/wiki/SQL) ‚Äì Structured Query Language

Sublanguages:

- **DDL**: Data Definition Language (CREATE, ALTER, DROP, ...)
- **DQL**: Data Query Language (SELECT)
- **DML**: Data Manipulation Language (INSERT, UPDATE, DELETE, ...)
- **DCL**: Data Control Language (CREATE USER, GRANT, REVOKE)
- **TCL**: Transaction Control Language (BEGIN, COMMIT, ROLLBACK, ...)

## Uk√°zkov√Ω datab√°zov√Ω model / pr√°ce s tabulkami (DDL, DQL, DML)

_[Postgres Ch. 2](https://www.postgresql.org/docs/current/tutorial-sql.html)_

Svƒõtad√≠ly:

```sql
create table continent (
  id   integer      primary key,    -- PK implies "not null"
  name varchar(100) not null unique -- "not null" must be explicit here
);
-- table name: continent or continents?
```

Zemƒõ:

```sql
create table country (
  code         char(2)      primary key,
  id_continent integer      references continent(id), -- Yoda: id_continent
  name         varchar(100) not null unique
);
```

M√≠sta (mƒõsta, stanice, ...):

```sql
create table place (
  id           serial       primary key,
  name         varchar(100) not null,
  code_country char(2)      references country(code),
  latitude     decimal(8,5) not null,  -- precision: ~1m
  longitude    decimal(8,5) not null,
  elevation    int                     -- meters above sea level
);

```

Denn√≠ poƒças√≠:

```sql
create table weather (  -- daily weather data
    id       serial primary key,      -- is it needed?
    id_place int    references place(id),
    date     date   not null,         -- date / date üòá

    temp_lo  decimal(4,1),            -- daily min temp (¬∞C)
    temp_hi  decimal(4,1),            -- daily max temp (¬∞C)
    precip   decimal(6,2),            -- precipitation (mm)

    unique(id_place, date)            -- ensure one record per day per place
);
```

## ERD - Entity-Relationship Diagram

- Tools / ERD tool
- Table / ERD for table

Volba:

1. ERD ‚ûú datab√°ze, tabulky, vazby
2. Jednoduch√Ω diagram nap≈ô. v [draw.io](https://app.diagrams.net/) ‚ûú datab√°ze ‚ûú generovan√Ω ERD

### Metoda 2:

#### Jednoduch√Ω ERD, roll-my-own notation (Chen + Crow's Foot):

![Jednoduch√Ω ERD](.img/ERD1.png)

### Generovan√Ω ERD:

![Generovan√Ω ERD](.img/ERD2.png)

# Integrita datab√°ze

_Referenƒçn√≠ integrita_ zaji≈°≈•uje vztahy (vazby) mezi tabulkami.

- PK `primary key`
- FK `references table(field)`

Integrita dat zaji≈°≈•uje spr√°vnost dat v tabulce.

- `not null`
- `unique`
- `check (condition)`

Preferujeme ‚Äûsilnƒõ poutahovanou datab√°zi‚Äú, tj. zaji≈°tƒõn√≠ integrity na √∫rovni datab√°ze, nikoli v aplikaƒçn√≠ logice.

## Jak√© probl√©my m√° n√°≈° model‚ùì

```sql
truncate table weather, place, country, continent
restart identity cascade;

-- negative id
insert into continent (id, name) values
  (-1, 'Atlantis');

-- trailing space, near-duplicate name
insert into continent (id, name) values
  (9,  'Europe ');

-- lowercase code; null continent
insert into country (code, id_continent, name) values
  ('zz', null, 'Nowhere Land');

-- short country code
insert into country (code, id_continent, name) values
  ('Z', 9, 'Zedland');

-- code and name differ only in case
insert into country (code, id_continent, name) values
  ('ZZ', 9, 'ZedLAnd');

-- empty name; wild coordinates
insert into place (name, code_country, latitude, longitude, elevation) values
  ('', 'ZZ', 95.00000, -200.00000, -500);

-- duplicate name
insert into place (name, code_country, latitude, longitude, elevation) values
  ('Z√°lu≈æ√≠', 'ZZ', 0.00000, 0.00000, 10),
  ('Z√°lu≈æ√≠', 'ZZ', 0.00000, 0.00000, 10);

-- no place, temp.hi < lo, negative precipitation
insert into weather (id_place, date, temp_lo, temp_hi, precip) values
  (null, date '2025-01-01', 20.0, -10.0, -5.00);

-- extreme weather values
insert into weather (id_place, date, temp_lo, temp_hi, precip) values
  (1, date '2025-01-01', -49.0, 99.0,  9999.99);
```
